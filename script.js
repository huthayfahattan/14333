// Data: Menu of L‚Äôolivo
const menu = [
  {
    id: 'sandwiches-signature',
    title: 'ü•™ ÿ≥ŸÜÿØŸàŸäÿ™ÿ¥ÿßÿ™ ŸÖŸÖŸäÿ≤ÿ©',
    description: 'ÿßÿÆÿ™Ÿäÿßÿ± ŸÖŸÜ ÿ£ŸÅÿ∂ŸÑ ÿßŸÑÿ≥ŸÜÿØŸàŸäÿ™ÿ¥ÿßÿ™ ÿ®ÿ∑ÿßÿ®ÿπ ŸÑŸàŸÑŸäŸÅŸà',
    items: [
      { id: 'special-sandwich', name: "L‚Äôolivo Special Sandwich", desc: 'ÿ¨ÿ®ŸÜÿ© ÿ•ŸÖŸÜÿ™ÿßŸÑ & ÿ¥ŸäÿØÿ±ÿå ÿÆÿ±ÿ¥ŸàŸÅÿå ÿ£Ÿàÿ±Ÿäÿ∫ÿßŸÜŸàÿå ÿµŸàÿµ ÿÆÿßÿµ', price: 27.6 },
      { id: 'cheese-club', name: 'Cheese Club Sandwich', desc: 'ÿ®ÿßÿ±ŸÖŸäÿ≤ÿßŸÜ & ÿ•ŸÖŸÜÿ™ÿßŸÑÿå ÿ∑ŸÖÿßÿ∑ŸÖÿå ÿ£Ÿàÿ±Ÿäÿ∫ÿßŸÜŸà + ÿµŸàÿµ', price: 33.35 },
      { id: 'roast-beef', name: 'Roast Beef Sandwich', desc: 'ÿ±Ÿàÿ≥ÿ™ ÿ®ŸäŸÅ ŸÖÿØÿÆŸÜÿå ÿ•ŸÖŸÜÿ™ÿßŸÑÿå ÿÆÿ±ÿØŸÑÿå ÿ£Ÿàÿ±Ÿäÿ∫ÿßŸÜŸà + ÿµŸàÿµ', price: 32.2 },
      { id: 'italian-tuna', name: 'Italian Tuna Sandwich', desc: 'ÿ™ŸàŸÜÿ© ÿ•Ÿäÿ∑ÿßŸÑŸäÿ©ÿå ÿ•ŸÖŸÜÿ™ÿßŸÑÿå ÿ∑ŸÖÿßÿ∑ŸÖÿå ÿ£Ÿàÿ±Ÿäÿ∫ÿßŸÜŸà + ÿµŸàÿµ', price: 39.1 },
      { id: 'mozzarella-bufala', name: 'Mozzarella Bufala Sandwich', desc: 'ŸÖŸàÿ≤ÿßÿ±ŸäŸÑÿß ÿ®ŸàŸÅÿßŸÑÿßÿå ÿ∑ŸÖÿßÿ∑ŸÖÿå ÿ£Ÿàÿ±Ÿäÿ∫ÿßŸÜŸàÿå ÿ®Ÿäÿ≥ÿ™Ÿàÿå ÿÆÿ®ÿ≤ ÿ¥ÿßÿ®ÿßÿ™ÿß ÿ≤Ÿäÿ™ŸàŸÜ', price: 33.35 },
      { id: 'turkey-royal', name: 'Turkey Royal', desc: 'ÿØŸäŸÉ ÿ±ŸàŸÖŸä ŸÖÿØÿÆŸÜÿå ÿ•ŸÖŸÜÿ™ÿßŸÑÿå ÿ∑ŸÖÿßÿ∑ŸÖÿå ÿ£Ÿàÿ±Ÿäÿ∫ÿßŸÜŸà + ÿµŸàÿµ', price: 51.75 },
    ],
  },
  {
    id: 'gathering-boxes',
    title: 'üéÅ ÿ®ŸàŸÉÿ≥ÿßÿ™ ÿßŸÑÿ¨ŸÖÿπÿßÿ™',
    description: 'ÿÆŸäÿßÿ±ÿßÿ™ ŸÖÿ™ŸÜŸàÿπÿ© ŸÑŸÑÿ≠ŸÅŸÑÿßÿ™ ŸàÿßŸÑÿ¨ŸÖÿπÿßÿ™',
    items: [
      { id: 'make-your-box', name: 'ÿßÿµŸÜÿπ ÿ®ŸàŸÉÿ≥', desc: 'ÿ¨ŸÖŸäÿπ ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ≥ŸÜÿØŸàŸäÿ™ÿ¥ÿßÿ™ ÿßŸÑŸÖŸÖŸäÿ≤ÿ© ÿßŸÑÿ≥ÿ™ÿ©', price: 198.95 },
      { id: 'mini-bites', name: 'ŸÑŸàŸÑŸäŸÅŸà ŸÖŸäŸÜŸä ÿ®ÿßŸäÿ™ ÿ®ŸàŸÉÿ≥', desc: 'ÿ¨ŸÖŸäÿπ ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ≥ŸÜÿØŸàŸäÿ™ÿ¥ÿßÿ™ ÿßŸÑŸÖŸÖŸäÿ≤ÿ© ÿßŸÑÿ≥ÿ™ÿ©', price: 198.95 },
      { id: 'small-focaccia', name: 'ÿ®ŸàŸÉÿ≥ ŸÅŸàŸÉÿßÿ¥Ÿäÿß ÿµÿ∫Ÿäÿ±', desc: 'ÿ¨ŸÖŸäÿπ ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ≥ŸÜÿØŸàŸäÿ™ÿ¥ÿßÿ™ ÿßŸÑŸÖŸÖŸäÿ≤ÿ© ÿßŸÑÿ≥ÿ™ÿ©', price: 198.95 },
      { id: 'pretzel-box', name: 'ÿ®ŸàŸÉÿ≥ ÿßŸÑÿ®ÿ±Ÿäÿ™ÿ≤ŸÑ', desc: 'ÿ¨ŸÖŸäÿπ ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ≥ŸÜÿØŸàŸäÿ™ÿ¥ÿßÿ™ ÿßŸÑŸÖŸÖŸäÿ≤ÿ© ÿßŸÑÿ≥ÿ™ÿ©', price: 198.95 },
      { id: 'croissant-box', name: 'ŸÉÿ±Ÿàÿßÿ≥ŸàŸÜ ÿ®ŸàŸÉÿ≥', desc: 'ÿ¨ŸÖŸäÿπ ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ≥ŸÜÿØŸàŸäÿ™ÿ¥ÿßÿ™ ÿßŸÑŸÖŸÖŸäÿ≤ÿ© ÿßŸÑÿ≥ÿ™ÿ©', price: 198.95 },
    ],
  },
  {
    id: 'grilled-meat',
    title: 'ü•© ÿ≥ŸÜÿØŸàŸäÿ™ÿ¥ÿßÿ™ ŸÖÿ¥ŸàŸäÿ© Ÿàÿ£ÿ∑ÿ®ÿßŸÇ ÿßŸÑŸÑÿ≠ŸàŸÖ',
    description: 'ŸÖÿ¥ŸàŸäÿßÿ™ ŸÑÿ∞Ÿäÿ∞ÿ© Ÿàÿ∑ÿ±Ÿäÿ©',
    items: [
      { id: 'grilled-chicken-pesto', name: 'ÿØÿ¨ÿßÿ¨ ŸÖÿ¥ŸàŸä ÿ®Ÿäÿ≥ÿ™Ÿà', price: 36 },
      { id: 'grilled-halloumi-pesto', name: 'ÿ≠ŸÑŸàŸÖŸä ÿ®Ÿäÿ≥ÿ™Ÿà ŸÖÿ¥ŸàŸä', price: 34 },
      { id: 'manzo-tenderloin', name: 'ŸÑÿ≠ŸÖ ŸÖÿßŸÜÿ≤Ÿà ÿ™ŸÜÿØÿ±ŸÑŸàŸäŸÜ ŸÖÿ™ÿ®ŸëŸÑ', price: 49.45 },
      { id: 'truffle-steak', name: 'ÿ™ÿ±ŸÅŸÑ ÿ≥ÿ™ŸäŸÉ', price: 49.45 },
      { id: 'steak-frites', name: 'ÿ≥ÿ™ŸäŸÉ ŸÅÿ±Ÿäÿ™ÿ≥', price: 49.45 },
    ],
  },
  {
    id: 'salads',
    title: 'ü•ó ÿ≥ŸÑÿ∑ÿßÿ™ (Salads)',
    description: 'ÿ≥ŸÑÿ∑ÿßÿ™ ÿ∑ÿßÿ≤ÿ¨ÿ© ŸàŸÖÿ™Ÿàÿßÿ≤ŸÜÿ©',
    items: [
      { id: 'lolivo-salad', name: 'ÿ≥ŸÑÿ∑ÿ© ŸÑŸàŸÑŸäŸÅŸà', desc: 'ÿÆÿ≥ ÿπÿ∂ŸàŸäÿå ÿ¨ÿ±ÿ¨Ÿäÿ±ÿå ÿ∑ŸÖÿßÿ∑ŸÖ ŸÉÿ±ÿ≤Ÿäÿ©ÿå ÿ®ÿßÿ±ŸÖŸäÿ≤ÿßŸÜÿå ÿ£Ÿàÿ±Ÿäÿ∫ÿßŸÜŸàÿå ÿÆŸÑ ÿ®ŸÑÿ≥ŸÖŸäŸÉ', price: 32 },
      { id: 'caesar-chicken', name: 'ÿ≥ŸÑÿ∑ÿ© ÿØÿ¨ÿßÿ¨ ÿ≥Ÿäÿ≤ÿ±', desc: 'ÿØÿ¨ÿßÿ¨ ŸÖÿ™ÿ®ŸÑÿå ÿÆÿ≥ÿå ÿÆÿ®ÿ≤ ŸÖÿ≠ŸÖŸëÿµÿå ÿ®ÿßÿ±ŸÖŸäÿ≤ÿßŸÜÿå ÿµŸàÿµ ÿ≥Ÿäÿ≤ÿ±', price: 32 },
      { id: 'chicken-feta', name: 'ÿ≥ŸÑÿ∑ÿ© ÿØÿ¨ÿßÿ¨ Ÿà ŸÅŸäÿ™ÿß', desc: 'ÿØÿ¨ÿßÿ¨ ŸÖÿ™ÿ®ŸÑÿå ÿÆÿ≥ÿå ŸÅŸäÿ™ÿßÿå ÿ∑ŸÖÿßÿ∑ŸÖ ŸÉÿ±ÿ≤Ÿäÿ©ÿå ÿ≤Ÿäÿ™ ÿ≤Ÿäÿ™ŸàŸÜ ÿ®ÿßŸÑŸÑŸäŸÖŸàŸÜ', price: 29 },
    ],
  },
  {
    id: 'sides',
    title: 'üßÄ ÿ£ÿ∑ÿ®ÿßŸÇ ÿ¨ÿßŸÜÿ®Ÿäÿ© ŸÖÿ¥ŸáŸàÿ±ÿ©',
    description: 'ŸÖÿ¥ÿßÿ±ŸÉÿßÿ™ ŸàŸÑŸÑŸÇÿπÿØÿ©',
    items: [
      { id: 'big-cheese-platter', name: 'ÿ∑ÿ®ŸÇ ÿ¨ÿ®ŸÜ ŸÉÿ®Ÿäÿ±', price: 259 },
    ],
  },
  {
    id: 'fries',
    title: 'üçü ÿ¥ÿ±ÿßÿ¶ÿ≠ ÿßŸÑÿ®ÿ∑ÿßÿ∑ÿ≥',
    description: 'ŸÖŸÇÿ±ŸÖÿ¥ÿ© Ÿàÿ≥ÿßÿÆŸÜÿ©',
    items: [
      { id: 'truffle-fries', name: 'ÿ¥ÿ±ÿßÿ¶ÿ≠ ÿßŸÑÿ®ÿ∑ÿßÿ∑ÿ≥ ŸÖÿπ ÿßŸÑÿ™ÿ±ÿßŸÅŸÑ', price: 18 },
      { id: 'salt-pepper-fries', name: 'ÿ¥ÿ±ÿßÿ¶ÿ≠ ÿßŸÑÿ®ÿ∑ÿßÿ∑ÿ≥ ŸÖÿπ ÿßŸÑŸÅŸÑŸÅŸÑ ŸàÿßŸÑŸÖŸÑÿ≠', price: 17 },
    ],
  },
  {
    id: 'drinks',
    title: 'ü•§ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿ®ÿßÿ™',
    description: 'ŸÖŸÜÿπÿ¥ÿ© Ÿàÿ∑ÿ®ŸäÿπŸäÿ©',
    items: [
      { id: 'soda', name: 'ŸÖÿ¥ÿ±Ÿàÿ® ÿ∫ÿßÿ≤Ÿä', desc: 'ŸÉŸàŸÉÿß ŸÉŸàŸÑÿßÿå ÿ≥ÿ®ÿ±ÿßŸäÿ™ÿå Ÿàÿ∫Ÿäÿ±Ÿáÿß', price: 5 },
      { id: 'mango-strawberry-juice', name: 'ÿπÿµŸäÿ± ŸÖÿßŸÜÿ¨Ÿà ÿ∑ÿßÿ≤ÿ¨ / ŸÅÿ±ÿßŸàŸÑÿ©', price: 12 },
      { id: 'orange-juice', name: 'ÿπÿµŸäÿ± ÿ®ÿ±ÿ™ŸÇÿßŸÑ ÿ∑ÿ®ŸäÿπŸä', price: 12 },
    ],
  },
];

// State: cart
const cart = new Map(); // key: itemId, value: { item, qty }

// Elements
const menuContainer = document.getElementById('menuContainer');
const categoryNav = document.getElementById('categoryNav');
const cartDrawer = document.getElementById('cartDrawer');
const openCartBtn = document.getElementById('openCartBtn');
const closeCartBtn = document.getElementById('closeCartBtn');
const cartItemsEl = document.getElementById('cartItems');
const cartCountEl = document.getElementById('cartCount');
const cartTotalEl = document.getElementById('cartTotal');
const checkoutBtn = document.getElementById('checkoutBtn');
const backdrop = document.getElementById('backdrop');
const checkoutModal = document.getElementById('checkoutModal');
const closeCheckoutBtn = document.getElementById('closeCheckoutBtn');
const cancelCheckout = document.getElementById('cancelCheckout');
const checkoutForm = document.getElementById('checkoutForm');
const yearEl = document.getElementById('year');

// Utils
const formatPrice = (num) => `${num.toFixed(2)} ÿ±.ÿ≥`;

// Render category chips
function renderCategoryNav() {
  categoryNav.innerHTML = menu
    .map(
      (cat, idx) => `<button class="chip${idx === 0 ? ' active' : ''}" data-target="${cat.id}">${cat.title}</button>`
    )
    .join('');

  categoryNav.addEventListener('click', (e) => {
    const btn = e.target.closest('button[data-target]');
    if (!btn) return;
    const id = btn.getAttribute('data-target');
    document.querySelectorAll('.category-nav .chip').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const section = document.getElementById(id);
    if (section) section.scrollIntoView({ behavior: 'smooth', block: 'start' });
  });
}

// Render menu
function renderMenu() {
  menuContainer.innerHTML = menu
    .map((cat) => {
      const items = cat.items
        .map((it) => {
          return `
          <div class="card" data-id="${it.id}">
            <h4>${it.name}</h4>
            ${it.desc ? `<p>${it.desc}</p>` : '<p></p>'}
            <div class="actions">
              <span class="price">${formatPrice(it.price)}</span>
              <button class="primary-btn add-to-cart" data-id="${it.id}">ÿ£ÿ∂ŸÅ</button>
            </div>
          </div>`;
        })
        .join('');
      return `
      <section class="category-section" id="${cat.id}">
        <div class="category-header">
          <h3 class="category-title">${cat.title}</h3>
          ${cat.description ? `<p class="category-desc">${cat.description}</p>` : ''}
        </div>
        <div class="items-grid">${items}</div>
      </section>`;
    })
    .join('');

  // Bind add-to-cart
  menuContainer.addEventListener('click', (e) => {
    const btn = e.target.closest('.add-to-cart');
    if (!btn) return;
    const id = btn.getAttribute('data-id');
    const item = menu.flatMap(c => c.items).find((x) => x.id === id);
    if (!item) return;
    addToCart(item);
  });
}

function addToCart(item) {
  const existing = cart.get(item.id);
  if (existing) {
    existing.qty += 1;
  } else {
    cart.set(item.id, { item, qty: 1 });
  }
  updateCartUI();
}

function removeFromCart(itemId) {
  cart.delete(itemId);
  updateCartUI();
}

function changeQty(itemId, delta) {
  const entry = cart.get(itemId);
  if (!entry) return;
  entry.qty += delta;
  if (entry.qty <= 0) cart.delete(itemId);
  updateCartUI();
}

function calcTotals() {
  let count = 0;
  let total = 0;
  for (const { item, qty } of cart.values()) {
    count += qty;
    total += item.price * qty;
  }
  return { count, total };
}

function updateCartUI() {
  const { count, total } = calcTotals();
  cartCountEl.textContent = String(count);
  cartTotalEl.textContent = formatPrice(total);
  checkoutBtn.disabled = count === 0;

  if (count === 0) {
    cartItemsEl.innerHTML = '<p class="muted" style="text-align:center; margin: 14px 0;">ÿßŸÑÿ≥ŸÑÿ© ŸÅÿßÿ±ÿ∫ÿ©</p>';
    return;
  }

  cartItemsEl.innerHTML = Array.from(cart.values())
    .map(({ item, qty }) => {
      return `
      <div class="cart-item">
        <div class="meta">
          <div class="name">${item.name}</div>
          <div class="muted">${formatPrice(item.price)} √ó ${qty}</div>
        </div>
        <div class="qty">
          <button aria-label="ÿ•ŸÜŸÇÿßÿµ" data-action="dec" data-id="${item.id}">‚àí</button>
          <span>${qty}</span>
          <button aria-label="ÿ≤ŸäÿßÿØÿ©" data-action="inc" data-id="${item.id}">+</button>
          <button class="icon-btn" aria-label="ÿ≠ÿ∞ŸÅ" data-action="remove" data-id="${item.id}">üóëÔ∏è</button>
        </div>
      </div>`;
    })
    .join('');
}

// Drawer and modal controls
function openCart() {
  cartDrawer.classList.add('open');
  backdrop.hidden = false;
  cartDrawer.setAttribute('aria-hidden', 'false');
}
function closeCart() {
  cartDrawer.classList.remove('open');
  backdrop.hidden = true;
  cartDrawer.setAttribute('aria-hidden', 'true');
}

function openCheckout() {
  checkoutModal.classList.add('open');
  checkoutModal.setAttribute('aria-hidden', 'false');
  backdrop.hidden = false;
}
function closeCheckout() {
  checkoutModal.classList.remove('open');
  checkoutModal.setAttribute('aria-hidden', 'true');
  backdrop.hidden = true;
}

// Events
openCartBtn.addEventListener('click', openCart);
closeCartBtn.addEventListener('click', closeCart);
backdrop.addEventListener('click', () => { closeCart(); closeCheckout(); });

cartItemsEl.addEventListener('click', (e) => {
  const btn = e.target.closest('button');
  if (!btn) return;
  const id = btn.getAttribute('data-id');
  const action = btn.getAttribute('data-action');
  if (!id || !action) return;
  if (action === 'inc') changeQty(id, 1);
  if (action === 'dec') changeQty(id, -1);
  if (action === 'remove') removeFromCart(id);
});

checkoutBtn.addEventListener('click', () => {
  closeCart();
  openCheckout();
});

closeCheckoutBtn.addEventListener('click', closeCheckout);
cancelCheckout.addEventListener('click', closeCheckout);

checkoutForm.addEventListener('change', (e) => {
  if (e.target.name === 'fulfillment') {
    const addressField = checkoutForm.querySelector('.address-field');
    if (e.target.value === 'delivery') {
      addressField.hidden = false;
      addressField.querySelector('input').required = true;
    } else {
      addressField.hidden = true;
      addressField.querySelector('input').required = false;
    }
  }
});

checkoutForm.addEventListener('submit', (e) => {
  e.preventDefault();
  const formData = new FormData(checkoutForm);
  const order = {
    customer: {
      fullName: formData.get('fullName'),
      phone: formData.get('phone'),
      fulfillment: formData.get('fulfillment'),
      address: formData.get('address') || undefined,
      notes: formData.get('notes') || undefined,
    },
    items: Array.from(cart.values()).map(({ item, qty }) => ({ id: item.id, name: item.name, price: item.price, qty })),
    totals: calcTotals(),
    createdAt: new Date().toISOString(),
  };

  // For now, just show a confirmation and reset
  alert(`ÿ™ŸÖ ÿßÿ≥ÿ™ŸÑÿßŸÖ ÿ∑ŸÑÿ®ŸÉ ÿ®ŸÜÿ¨ÿßÿ≠!\nÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä: ${formatPrice(order.totals.total)}\nÿ≥ŸÜŸÇŸàŸÖ ÿ®ÿßŸÑÿ™ŸàÿßÿµŸÑ ŸÖÿπŸÉ ŸÇÿ±Ÿäÿ®Ÿãÿß.`);
  cart.clear();
  updateCartUI();
  closeCheckout();
  checkoutForm.reset();
});

// Init
renderCategoryNav();
renderMenu();
updateCartUI();
yearEl.textContent = new Date().getFullYear();


